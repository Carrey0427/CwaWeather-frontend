<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Weather 36H Forecast</title>
    <link rel="icon" type="image/png" href="./icon-v3.jpg">
    <link rel="apple-touch-icon" href="./icon-v3.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-v3.jpg">

    <!-- Google Font (å…±ç”¨å­—é«”) -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">

    <!-- ===== 711 ä¸»é¡Œæ¨£å¼ ===== -->
    <style id="style-711">
        :root {
            --ac-green: #7DE1A9;
            --ac-bg-pattern: #8FD8AF;
            --ac-cream: #FFFEF2;
            --ac-yellow: #F9F195;
            --ac-brown: #796452;
            --ac-blue: #4FB5D9;
            --ac-dark: #58504A;
            --ac-card-border: #E6E0C8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--ac-green);
            background-image:
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 20px,
                    rgba(255, 255, 255, 0.2) 20px,
                    rgba(255, 255, 255, 0.2) 40px
                );
            min-height: 100vh;
            color: var(--ac-dark);
            overflow-x: hidden;
            padding-bottom: 20px;
        }

        /* é ‚éƒ¨ç‹€æ…‹åˆ— */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .location-pill {
            background: var(--ac-yellow);
            color: var(--ac-brown);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 1.1rem;
            transform: rotate(-2deg);
            border: 2px solid white;
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
        }

        .update-pill {
            font-size: 0.8rem;
            color: white;
            background: rgba(0, 0, 0, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
        }

        .container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* ä»Šæ—¥ç„¦é»å¡ç‰‡ */
        .hero-card {
            background: var(--ac-cream);
            border-radius: 35px;
            padding: 30px 25px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border: 4px solid white;
            margin-bottom: 25px;
            position: relative;
        }

        .hero-period {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ac-blue);
            color: white;
            padding: 5px 20px;
            border-radius: 20px;
            font-weight: bold;
            border: 3px solid white;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
        }

        .hero-temp-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .hero-icon {
            font-size: 5rem;
            filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.1));
            animation: bounce 3s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hero-temp {
            font-size: 4.5rem;
            font-weight: 900;
            color: var(--ac-brown);
            line-height: 1;
        }

        .hero-desc {
            font-size: 1.5rem;
            color: #8A7B70;
            margin-bottom: 20px;
            font-weight: bold;
        }
        /* å»ºè­°å€å¡Š */
        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #E0D8C0;
        }

        .advice-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.5);
            padding: 10px;
            border-radius: 20px;
        }

        .advice-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .advice-text {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--ac-brown);
            margin: 5px 0;
            line-height: 1.2;
        }

        /* ç¨å¾Œé å ±æ¨™é¡Œ */
        .section-title {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 15px;
            margin-left: 10px;
            font-weight: 900;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.1);
        }

        /* æ©«å‘ Scroll å€åŸŸ */
        .scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        /* å°å¡ç‰‡ mini-card */
        .mini-card {
            min-width: 140px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 25px;
            padding: 20px 15px;
            text-align: center;
            border: 3px solid white;
            flex-shrink: 0;
        }

        .mini-time {
            background: var(--ac-green);
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            display: inline-block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .mini-icon {
            font-size: 2.5rem;
            margin: 5px 0;
        }

        .mini-temp {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--ac-dark);
        }

        /* Loading ç•«é¢ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--ac-green);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        /* ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• */
        .theme-switch {
            display: flex;
            gap: 6px;
            justify-content: center;
            align-items: center;
            flex: 1;
            max-width: 260px;
        }

        .theme-btn {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 999px;
            border: 2px solid rgba(255, 255, 255, 0.9);
            background: rgba(0, 0, 0, 0.1);
            color: #fff;
            font-weight: 700;
            white-space: nowrap;
            cursor: pointer;
        }

        .theme-btn.active {
            background: #FFD700;
            color: #2F4F4F;
            border-color: #fff;
        }
    </style>
    <style id="style-slime">
        /* ======================================= */
        /* === è½‰ç”Ÿå²èŠå§†ä¸»é¡Œè‰² (æœ±æ‹‰ãƒ»å¦æ´¾æ–¯ç‰¹) === */
        /* ======================================= */
        :root {
            --slime-blue: #4FB5D9;     /* å²èŠå§†æœ¬é«”è‰² */
            --shuna-pink: #FF9AA2;     /* æœ±èœçš„ç²‰è‰² */
            --shion-purple: #9258B1;   /* ç´«è‹‘çš„ç´«è‰² */
            --rimuru-gold: #FFD700;    /* åˆ©å§†è·¯é‡‘è‰²å…‰ç’° */
            --forest-green: #38761D;   /* æœ±æ‹‰å¤§æ£®æ—ç¶  */
            --card-base: #FFFEF2;      /* ç±³ç™½å¡ç‰‡åº•è‰² */
            --font-dark: #2F4F4F;      /* æ·±è‰²æ–‡å­— */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Serif TC', 'Zen Maru Gothic', sans-serif;
            background-color: var(--forest-green);
            background-image:
                repeating-linear-gradient(
                    45deg, 
                    transparent, 
                    transparent 15px, 
                    rgba(0, 0, 0, 0.1) 15px, 
                    rgba(0, 0, 0, 0.1) 30px
                );
            min-height: 100vh;
            color: var(--font-dark);
            overflow-x: hidden;
            padding-bottom: 20px;
        }

        /* é ‚éƒ¨ç‹€æ…‹åˆ—ï¼ˆå…¬æœƒé­”æ³•æ¿ï¼‰ */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(79, 181, 217, 0.6);
            backdrop-filter: blur(5px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 3px solid var(--rimuru-gold);
        }

        .location-pill {
            background: var(--rimuru-gold);
            color: var(--font-dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 1.1rem;
            transform: rotate(-1deg);
            border: 3px solid white;
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        }

        .update-pill {
            font-size: 0.9rem;
            color: white;
            background: rgba(0, 0, 0, 0.4);
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 700;
        }

        .container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* === ä»Šæ—¥ç„¦é»å¡ç‰‡ï¼ˆé­”æ³•æƒ…å ±æ›¸ï¼‰ === */
        .hero-card {
            background: var(--card-base);
            border-radius: 5px;
            padding: 30px 25px;
            text-align: center;
            border: 5px solid var(--shion-purple);
            margin-bottom: 25px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* é­”åŠ›çµæ™¶æ¨™ç±¤ */
        .hero-period {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%) rotate(-3deg);
            background: var(--slime-blue);
            color: white;
            padding: 5px 25px;
            border-radius: 5px;
            font-weight: 900;
            font-size: 1.1rem;
            border: 3px solid var(--rimuru-gold);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3);
        }

        @keyframes slime-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .hero-icon {
            font-size: 5rem;
            filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.2));
            animation: slime-bounce 2s infinite ease-in-out;
        }

        .hero-temp {
            font-size: 5rem;
            font-weight: 900;
            color: var(--shion-purple);
            line-height: 1;
        }

        .hero-desc {
            font-size: 1.8rem;
            color: var(--font-dark);
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(79, 181, 217, 0.5);
        }
        /* === é­”åœ‹è¯é‚¦ è£å‚™å»ºè­°å€ï¼ˆæˆ°é¬¥æº–å‚™ï¼‰ === */
        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 3px dashed var(--slime-blue);
        }

        .advice-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(79, 181, 217, 0.2);
            padding: 10px;
            border-radius: 15px;
            border: 2px solid var(--slime-blue);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .advice-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }

        .advice-text {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--font-dark);
            margin: 5px 0;
            line-height: 1.2;
        }

        /* === é ç¨‹è§€æ¸¬æƒ…å ±ï¼ˆç¨å¾Œé å ±ï¼‰ === */
        .section-title {
            font-size: 1.5rem;
            color: var(--rimuru-gold);
            margin-bottom: 15px;
            margin-left: 10px;
            font-weight: 900;
            text-shadow: 
                0 0 5px rgba(255, 215, 0, 0.8),
                1px 1px 0 rgba(0, 0, 0, 0.3);
            border-left: 5px solid var(--rimuru-gold);
            padding-left: 10px;
        }

        .scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        .mini-card {
            min-width: 140px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px 15px;
            text-align: center;
            border: 3px solid var(--shion-purple);
            flex-shrink: 0;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .mini-time {
            background: var(--shion-purple);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .mini-icon {
            font-size: 3rem;
            margin: 5px 0;
        }

        .mini-temp {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--font-dark);
        }

        /* === Loading ç•«é¢ï¼ˆåˆ©å§†è·¯é­”åŠ›è·³å‹•ï¼‰=== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--forest-green);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        @keyframes slime-loading {
            0%   { transform: translateY(0) rotate(0deg);   opacity: 1; }
            25%  { transform: translateY(-10px) rotate(5deg); opacity: 0.8; }
            50%  { transform: translateY(0) rotate(-5deg);   opacity: 1; }
            75%  { transform: translateY(5px) rotate(2deg);  opacity: 0.9; }
            100% { transform: translateY(0) rotate(0deg);    opacity: 1; }
        }

        .slime-loader {
            font-size: 4rem;
            color: var(--slime-blue);
            animation: slime-loading 1.5s infinite ease-in-out;
            text-shadow: 0 0 10px rgba(79, 181, 217, 0.8);
        }

        /* === ä¸»é¡Œåˆ‡æ›æŒ‰éˆ•ï¼ˆå…©ä¸»é¡Œå…±ç”¨ï¼‰ === */
        .theme-switch {
            display: flex;
            gap: 6px;
            justify-content: center;
            align-items: center;
            flex: 1;
            max-width: 260px;
        }

        .theme-btn {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 999px;
            border: 2px solid rgba(255, 255, 255, 0.9);
            background: rgba(0, 0, 0, 0.1);
            color: #fff;
            font-weight: 700;
            white-space: nowrap;
            cursor: pointer;
        }

        .theme-btn.active {
            background: #FFD700;
            color: #2F4F4F;
            border-color: #fff;
        }
    </style>
<body data-theme="711">

    <!-- Loading ç•«é¢ -->
    <div id="loading" class="loading-screen">
        <div style="font-size: 4rem; animation: bounce 2s infinite;">â˜ï¸</div>
        <p style="color: white; font-weight: bold; margin-top: 20px;">
            æ­£åœ¨è§€æ¸¬é›²çš„æµå‹•...
        </p>
    </div>

    <!-- é ‚éƒ¨ç‹€æ…‹åˆ— -->
    <div class="status-bar">

        <!-- å·¦ï¼šä½ç½® -->
        <div class="location-pill" id="locationPill">ğŸ“ è‡ºåŒ—</div>

        <!-- ä¸­ï¼šä¸»é¡Œåˆ‡æ› -->
        <div class="theme-switch">
            <button id="btnTheme711" class="theme-btn active">711 é¢¨æ ¼</button>
            <button id="btnThemeSlime" class="theme-btn">é­”åœ‹è¯é‚¦é¢¨æ ¼</button>
        </div>

        <!-- å³ï¼šæ›´æ–°æ™‚é–“ -->
        <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
    </div>

    <!-- ä¸»å…§å®¹ -->
    <div class="container" id="mainContent" style="display: none;">

        <!-- ä»Šæ—¥ç„¦é»å¤§å¡ç‰‡ -->
        <div id="heroCard"></div>

        <!-- ç¨å¾Œé å ±æ¨™é¡Œ -->
        <h3 class="section-title" id="sectionTitle">ç¨å¾Œé å ±</h3>

        <!-- ç¨å¾Œé å ±å¡ç‰‡ -->
        <div class="scroll-container" id="futureForecasts"></div>

    </div>
<script>
/* ================================
   å…±ç”¨ API URL
================================ */
const API_URL = "https://weather-nangang.zeabur.app/api/weather/kaohsiung";


/* =====================================================
   711 ä¸»é¡Œé‚è¼¯ï¼ˆTheme711ï¼‰
   â€”â€” å®Œæ•´åŒ…æˆä¸€å€‹ç‰©ä»¶ï¼Œä¾›ä¸»é¡Œåˆ‡æ›å™¨å‘¼å«
===================================================== */

const Theme711 = (() => {

    /* --------------------------
       å¤©æ°£åœ–ç¤ºï¼ˆ711 é¢¨æ ¼ï¼‰
    --------------------------- */
    function getWeatherIcon(weather) {
        if (!weather) return "ğŸŒ¤ï¸";
        if (weather.includes("æ™´")) return "â˜€ï¸";
        if (weather.includes("å¤šé›²")) return "â›…";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "â›ˆï¸";
        return "ğŸŒ¤ï¸";
    }

    /* --------------------------
       å»ºè­°ï¼ˆ711 é¢¨æ ¼ï¼‰
    --------------------------- */
    function getAdvice(rainProb, maxTemp) {
        let rainIcon = "ğŸŒ‚";
        let rainText = "ä¸ç”¨å¸¶å‚˜";

        if (parseInt(rainProb) > 30) {
            rainIcon = "â˜‚ï¸";
            rainText = "è¨˜å¾—å¸¶å‚˜ï¼";
        }

        let clothIcon = "ğŸ‘•";
        let clothText = "èˆ’é©ç©¿æ­";

        if (parseInt(maxTemp) >= 28) {
            clothIcon = "ğŸ½";
            clothText = "çŸ­è¢–å‡ºç™¼";
        } else if (parseInt(maxTemp) <= 20) {
            clothIcon = "ğŸ§¥";
            clothText = "åŠ ä»¶å¤–å¥—";
        }

        return { rainIcon, rainText, clothIcon, clothText };
    }

    /* --------------------------
       æ™‚æ®µåˆ¤æ–·ï¼ˆæ—©ã€ä¸­ã€æ™šï¼‰
    --------------------------- */
    function getTimePeriod(startTime) {
        const hour = new Date(startTime).getHours();

        if (hour >= 5 && hour < 11) return "æ—©æ™¨";
        if (hour >= 11 && hour < 14) return "ä¸­åˆ";
        if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
        if (hour >= 18 && hour < 23) return "æ™šä¸Š";
        return "æ·±å¤œ";
    }

    /* --------------------------
       å³ä¸Šè§’æ›´æ–°æ™‚é–“æ ¼å¼
    --------------------------- */
    function formatUpdateTime() {
        const now = new Date();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const dayIndex = now.getDay();
        const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];

        return `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
    }
    /* --------------------------
       æ¸²æŸ“ç•«é¢ï¼ˆHeroCard + æœªä¾†é å ±ï¼‰
    --------------------------- */
    function renderWeather(data) {
        const forecasts = data.forecasts;
        const current = forecasts[0];
        const others = forecasts.slice(1);

        /* --- ä»Šæ—¥ç„¦é»å¡ç‰‡ --- */
        const advice = getAdvice(current.rain, current.maxTemp);
        const period = getTimePeriod(current.startTime);
        const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

        document.getElementById('heroCard').innerHTML = `
            <div class="hero-card">
                <div class="hero-period">${period}</div>
                <div class="hero-temp-container">
                    <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                    <div class="hero-temp">${avgTemp}Â°</div>
                </div>
                <div class="hero-desc">${current.weather}</div>

                <div class="advice-grid">
                    <div class="advice-item">
                        <div class="advice-icon">${advice.rainIcon}</div>
                        <div class="advice-text">${advice.rainText}</div>
                        <div style="font-size:0.7rem; color:#999">é™é›¨ç‡ ${current.rain}</div>
                    </div>

                    <div class="advice-item">
                        <div class="advice-icon">${advice.clothIcon}</div>
                        <div class="advice-text">${advice.clothText}</div>
                        <div style="font-size:0.7rem; color:#999">æœ€é«˜æº« ${current.maxTemp}Â°</div>
                    </div>
                </div>
            </div>
        `;

        /* --- ç¨å¾Œé å ± --- */
        const scrollContainer = document.getElementById('futureForecasts');
        scrollContainer.innerHTML = "";

        const todayDate = new Date().getDate();

        others.forEach(f => {
            let p = getTimePeriod(f.startTime);

            // åˆ¤æ–·æ˜¯å¦è·¨æ—¥ â†’ æ˜å¤©
            const fDate = new Date(f.startTime);
            if (fDate.getDate() !== todayDate) {
                p = "æ˜å¤© " + p;
            }

            scrollContainer.innerHTML += `
                <div class="mini-card">
                    <div class="mini-time">${p}</div>
                    <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                    <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
                    <div style="font-size:0.8rem; color:#888; margin-top:5px;">ğŸ’§${f.rain}</div>
                </div>
            `;
        });

        // å³ä¸Šè§’æ™‚é–“
        document.getElementById('updateTime').textContent = formatUpdateTime();
    }

    /* --------------------------
       å–å¾—æ°£è±¡è³‡æ–™ï¼ˆå« Loadingï¼‰
    --------------------------- */
    async function fetchWeather() {
        try {
            // è‡³å°‘ç­‰ 1.5 ç§’è®“ Loading æœ‰è¡¨ç¾
            const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
            const fetchPromise = fetch(API_URL).then(res => res.json());

            const [_, json] = await Promise.all([delayPromise, fetchPromise]);

            if (json.success) {
                renderWeather(json.data);

                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } else {
                throw new Error("API Error");
            }
        } catch (err) {
            console.error(err);
            alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œç‹¸å…‹æŠŠç¶²è·¯ç·šå’¬æ–·äº†ï¼");
        }
    }

    /* --------------------------
       æä¾›çµ¦å¤–éƒ¨ä¸»é¡Œåˆ‡æ›å™¨ä½¿ç”¨
    --------------------------- */
    return {
        fetchWeather,
        getWeatherIcon,
        getAdvice,
        getTimePeriod,
        formatUpdateTime
    };

})(); // Theme711 çµæŸ
/* =====================================================
   å²èŠå§†ä¸»é¡Œé‚è¼¯ï¼ˆThemeSlimeï¼‰
   â€”â€” å®Œæ•´åŒ…æˆç‰©ä»¶ï¼Œä¾›ä¸»é¡Œåˆ‡æ›å™¨ applyTheme() ä½¿ç”¨
===================================================== */

const ThemeSlime = (() => {

    /* --------------------------
       å¤©æ°£åœ–ç¤ºï¼ˆé­”åœ‹è¯é‚¦ç‰ˆï¼‰
    --------------------------- */
    function getWeatherIcon(weather) {
        if (!weather) return "ğŸ’§";              // å²èŠå§†é è¨­
        if (weather.includes("æ™´")) return "âœ¨"; // æ›¦å…‰é­”åŠ›
        if (weather.includes("å¤šé›²")) return "ğŸŒ«ï¸";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "âš¡"; // é»‘é›·
        return "ğŸ’§";
    }

    /* --------------------------
       å»ºè­°æ–‡æ¡ˆï¼ˆé­”ç‹è»è¦æ ¼ï¼‰
    --------------------------- */
    function getAdvice(rainProb, maxTemp) {
        let rainIcon = "ğŸ›¡ï¸";
        let rainText = "é­”åŠ›è­·ç½©æ­£å¸¸";

        if (parseInt(rainProb) > 30) {
            rainIcon = "ğŸŒŠ";
            rainText = "ã€æ°´åˆ€ã€è¡“å¼æº–å‚™ï¼";
        }

        let clothIcon = "âš”ï¸";
        let clothText = "è¼•è£è¡Œå‹•";

        if (parseInt(maxTemp) >= 28) {
            clothIcon = "ğŸ”¥";
            clothText = "é«˜ç†±è­¦æˆ’ï¼ˆç«ç„°é­”æ³•æ³¨æ„ï¼‰";
        } else if (parseInt(maxTemp) <= 20) {
            clothIcon = "â„ï¸";
            clothText = "å¯’æ°£ä¾µè¥²ï¼ˆå†°ç³»é­”æ³•æ³¨æ„ï¼‰";
        }

        return { rainIcon, rainText, clothIcon, clothText };
    }

    /* --------------------------
       é­”åœ‹æ™‚æ®µæ–‡æ¡ˆ
    --------------------------- */
    function getTimePeriod(startTime) {
        const hour = new Date(startTime).getHours();

        if (hour >= 5 && hour < 11) return "é»æ˜æ¢ç´¢";
        if (hour >= 11 && hour < 14) return "æ­£åˆäº¤æˆ°";
        if (hour >= 14 && hour < 18) return "åˆå¾Œä½ˆé™£";
        if (hour >= 18 && hour < 23) return "å¤œé–“è­¦æˆ’";
        return "æ·±å¤œæ½›ä¼";
    }

    /* --------------------------
       é­”åœ‹è¯é‚¦æ›†æ³•ï¼ˆå³ä¸Šè§’ï¼‰
    --------------------------- */
    function formatUpdateTime() {
        const now = new Date();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const days = ["é­”é€±æ—¥","é­”é€±ä¸€","é­”é€±äºŒ","é­”é€±ä¸‰","é­”é€±å››","é­”é€±äº”","é­”é€±å…­"];
        const dow = days[now.getDay()];

        return `é­”æœˆ${month}æ—¥${date} ${dow}`;
    }


    /* --------------------------
       æ¸²æŸ“ç•«é¢ï¼ˆé­”åœ‹ç‰ˆ HeroCardï¼‰
    --------------------------- */
    function renderWeather(data) {
        const forecasts = data.forecasts;
        const current = forecasts[0];
        const others = forecasts.slice(1);

        const advice = getAdvice(current.rain, current.maxTemp);
        const period = getTimePeriod(current.startTime);
        const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

        /* --- HeroCard é­”åœ‹ç‰ˆæœ¬ --- */
        document.getElementById('heroCard').innerHTML = `
            <div class="hero-card">
                <div class="hero-period">ğŸ“œ ${period} æƒ…å ±</div>

                <div class="hero-temp-container">
                    <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                    <div class="hero-temp">${avgTemp}Â°</div>
                </div>

                <div class="hero-desc">ã€${current.weather}ã€é­”åŠ›åæ‡‰</div>

                <div class="advice-grid">
                    <div class="advice-item">
                        <div class="advice-icon">${advice.rainIcon}</div>
                        <div class="advice-text">${advice.rainText}</div>
                        <div style="font-size:0.8rem; color:#999">
                            é­”åŠ›æ¿•åº¦ ${current.rain}
                        </div>
                    </div>

                    <div class="advice-item">
                        <div class="advice-icon">${advice.clothIcon}</div>
                        <div class="advice-text">${advice.clothText}</div>
                        <div style="font-size:0.8rem; color:#999">
                            é­”åŠ›é«˜å³° ${current.maxTemp}Â°
                        </div>
                    </div>
                </div>
            </div>
        `;

        /* --- ç¨å¾Œé å ±ï¼ˆé­”åœ‹ç‰ˆï¼‰ --- */
        const container = document.getElementById("futureForecasts");
        container.innerHTML = "";

        const today = new Date().getDate();

        others.forEach(f => {
            let p = getTimePeriod(f.startTime);

            const d = new Date(f.startTime);
            if (d.getDate() !== today) {
                // æ¬¡æ—¥ + å»æ‰å°¾ç«¯è©
                p = "æ¬¡æ—¥" + p.replace("æ¢ç´¢","").replace("äº¤æˆ°","").replace("ä½ˆé™£","").replace("è­¦æˆ’","").replace("æ½›ä¼","");
            }

            container.innerHTML += `
                <div class="mini-card">
                    <div class="mini-time">${p}</div>
                    <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                    <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
                    <div style="font-size:0.8rem;color:#888;margin-top:5px;">
                        ğŸ’§${f.rain}
                    </div>
                </div>
            `;
        });

        document.getElementById("updateTime").textContent = formatUpdateTime();
    }


    /* --------------------------
       å–å¾—æ°£è±¡è³‡æ–™ï¼ˆå«å²èŠå§† Loadingï¼‰
    --------------------------- */
    async function fetchWeather() {
        try {
            const delayPromise = new Promise(res => setTimeout(res, 1500));
            const fetchPromise = fetch(API_URL).then(r => r.json());

            const [_, json] = await Promise.all([delayPromise, fetchPromise]);

            if (json.success) {
                renderWeather(json.data);

                document.getElementById("loading").style.display = "none";
                document.getElementById("mainContent").style.display = "block";
            } else {
                throw new Error("API Error");
            }
        } catch (err) {
            console.error(err);
            alert("ã€æ™ºæ…§ä¹‹ç‹ã€è§£æå¤±æ•—ï¼Œè«‹å‘åˆ©å§†è·¯å¤§äººå›å ±é­”åŠ›æµå‘ç•°å¸¸ï¼");
        }
    }


    /* ç‰©ä»¶è¼¸å‡º */
    return {
        fetchWeather,
        getWeatherIcon,
        getAdvice,
        getTimePeriod,
        formatUpdateTime
    };

})(); // ThemeSlime çµæŸ

/* =====================================================
   ä¸»é¡Œåˆ‡æ›æ§åˆ¶å™¨ï¼ˆapplyThemeï¼‰
===================================================== */

let currentTheme = "711";   // é è¨­ä¸»é¡Œ

function applyTheme(theme) {

    /* é¿å…é‡è¤‡åˆ‡æ›é€ æˆé‡æ–°æŠ“è³‡æ–™ */
    if (theme === currentTheme &&
        document.getElementById("mainContent").style.display === "block") {
        return;
    }

    currentTheme = theme;
    document.body.dataset.theme = theme;

    /* å•Ÿç”¨æˆ–åœç”¨ CSS */
    document.getElementById("style-711").disabled   = (theme !== "711");
    document.getElementById("style-slime").disabled = (theme !== "slime");

    /* æŒ‰éˆ• active æ¨£å¼ */
    document.getElementById("btnTheme711").classList.toggle("active", theme === "711");
    document.getElementById("btnThemeSlime").classList.toggle("active", theme === "slime");

    /* å›ºå®šæ–‡å­—ï¼ˆä¾‹å¦‚å·¦ä¸Šä½ç½®ï¼‰ */
    const locationPill = document.getElementById("locationPill");
    const sectionTitle = document.getElementById("sectionTitle");

    if (locationPill) {
        locationPill.textContent = 
            theme === "711" ? "ğŸ“ è‡ºåŒ—" : "ğŸ“ å¦æ´¾æ–¯ç‰¹é¦–éƒ½";
    }

    if (sectionTitle) {
        sectionTitle.textContent =
            theme === "711"
                ? "ç¨å¾Œé å ±ï¼ˆ36 å°æ™‚ï¼‰"
                : "ğŸ”® é ç¨‹é­”æ³•è§€æ¸¬æƒ…å ±";
    }

    /* Loading ç•«é¢åˆ‡æ› */
    document.getElementById("loading").style.display = "flex";
    document.getElementById("mainContent").style.display = "none";

    document.getElementById("updateTime").textContent = "æ›´æ–°ä¸­...";

    /* å‘¼å«ä¸»é¡Œå°ˆå±¬ fetchWeather */
    if (theme === "711") {
        Theme711.fetchWeather().then(() => {
            localStorage.setItem("weatherTheme", "711");
        });
    } else {
        ThemeSlime.fetchWeather().then(() => {
            localStorage.setItem("weatherTheme", "slime");
        });
    }
}


/* =====================================================
   DOMContentLoadedï¼šåˆå§‹åŒ–
===================================================== */

document.addEventListener("DOMContentLoaded", () => {

    const savedTheme = localStorage.getItem("weatherTheme") || "711";

    /* ç¶å®šåˆ‡æ›æŒ‰éˆ• */
    document.getElementById("btnTheme711")
        .addEventListener("click", () => applyTheme("711"));

    document.getElementById("btnThemeSlime")
        .addEventListener("click", () => applyTheme("slime"));

    /* å¥—ç”¨ä¸»é¡Œï¼Œä¸¦è‡ªå‹•æŠ“å–å¤©æ°£è³‡æ–™ */
    applyTheme(savedTheme);
});
</script>

